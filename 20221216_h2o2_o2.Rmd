---
title: "H2O2 and O2 correlations"
output: html_document
date: '2022-12-15'
---


```{r setup, echo =FALSE}
.libPaths('C:\\Users\\zuendj\\Documents\\R4Libs')
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = "C:/Users/zuendj/Desktop/03_data R/oxidative stress", cho = TRUE, warning = FALSE, message = FALSE)

# Install Packages:
# install.packages("rlang")
# install.packages("tidyr")
# install.packages("ggbreak")


 # library(tidyverse)
# library(ggplot2)
# library(tidyr)
# # install.packages("devtools")
# # devtools::install_github("slowkow/ggrepel")
# library(ggrepel)
# library(ggbreak)
# library(openxlsx)
```

# 1. Load the data and calculate median MIC & MBC
```{r}
h2o2 = read.csv(file = "C:/Users/zuendj/Desktop/03_data R/oxidative stress/MIC_MBC_h2O2_difference.csv", sep=";", header=T, check.names =F)
o2 = read.csv(file = "C:/Users/zuendj/Desktop/03_data R/oxidative stress/MIC_MBC_O2_difference.csv", sep=";", header=T, check.names =F)
```

```{r}
h2o2 <- left_join(h2o2, data.frame(MIC = c(1,2,3,4,5,6,7,8,9,10,11,12), 
                                  concentration_MIC = c(0, 
                                                    0.0064, 
                                                    0.021,
                                                    0.066 ,
                                                    2.2,
                                                    6.8,  
                                                    21,
                                                    69,
                                                    222,
                                                    710,
                                                    2300, 
                                                    7300)))

h2o2 <- left_join(h2o2, data.frame(MBC = c(1,2,3,4,5,6,7,8,9,10,11,12), 
                                  concentration_MBC = c(0, 
                                                    0.0064, 
                                                    0.021,
                                                    0.066 ,
                                                    2.2,
                                                    6.8,  
                                                    21,
                                                    69,
                                                    222,
                                                    710,
                                                    2300, 
                                                    7300)))




o2 <- left_join(o2, data.frame(MIC = c(1,2,3,4,5,6,7,8,9,10,11,12), 
                                  concentration_MIC = c(1.5, 
                                                    1.28, 
                                                    1.08,
                                                    0.92 ,
                                                    0.78,
                                                    0.67,  
                                                    0.57,
                                                   0.48,
                                                    0.41,
                                                    0.35,
                                                    0.3, 
                                                    0)))
o2 <- left_join(o2, data.frame(MBC = c(1,2,3,4,5,6,7,8,9,10,11,12), 
                                  concentration_MBC = c(1.5, 
                                                    1.28, 
                                                    1.08,
                                                    0.92 ,
                                                    0.78,
                                                    0.67,  
                                                    0.57,
                                                   0.48,
                                                    0.41,
                                                    0.35,
                                                    0.3, 
                                                    0)))
```


```{r}
o2$stress<-"O2"
h2o2$stress<-"H2O2"

all<-rbind(o2, h2o2)

all[all== "Eubacterium eligens"]  = "Lachnospira eligens"


all$diff_conc<-all$concentration_MBC - all$concentration_MIC
```

#get taxonomy
```{r}
taxonomy = read.csv(file = "P:/Shared_documents/Janina_Zuend/08_phd/12_working_package_2/Strain_panel.csv", sep=";", header=T, check.names =F)
tax<-left_join(all, taxonomy)

```
```{r}
gather(tax, condition, value, "concentration_MBC":"concentration_MIC")->heat

heat$condition<-factor(heat$condition, levels=c("concentration_MIC", "concentration_MBC"))

heat<-left_join(heat, setNames(aggregate(heat$value, by=list(heat$bacteria), FUN=median), c("bacteria", "median")))
diff<-left_join(tax, setNames(aggregate(tax$diff_conc, by=list(tax$bacteria, tax$stress), FUN=median), c("bacteria", "stress","median_diff")))

names<-list("H2O2"=expression(H[2]*O[2]))

facet_labeller <- function(variable,value){
  return(names[value])
}


diff%>%
  subset(stress %in% c("H2O2"))->sub


sub<-left_join(sub, setNames(aggregate(sub$MIC, by=list(sub$bacteria), mean), c("bacteria", "order")))

sub$diff_conc<-sub$diff_conc/1000

sub%>%
  mutate(bacteria = fct_reorder(bacteria, sub$diff_conc))%>%
ggplot(aes(y=bacteria, x=diff_conc))+
  geom_boxplot(outlier.shape=NA, )+
  geom_jitter(width = 0.01, alpha=0.5, aes(colour=Family))+
  facet_grid(cols=vars(stress), scales="free", labeller= facet_labeller)+
  geom_vline(xintercept = 0, linetype="dashed")+
  theme(text = element_text(size=15), 
        axis.title.x = element_text(size=20),
        axis.text.x = element_text(size=15),
        axis.title.y= element_blank(),
        axis.text.y=element_text(size=15),
        strip.text = element_blank(),
        strip.background = element_blank(),
        axis.ticks.y = element_blank(),
        legend.text = element_text(size = 15),
        legend.title = element_text(size= 15),
        plot.title = element_text(size=20, hjust=0.5),
        panel.background = element_rect(fill="white"),
        panel.border=element_rect(fill=NA))+
  ggtitle("Difference in lethal and growth-inhibiting levels")+
  labs(colour = "Family")+
  xlab(expression(??H[2]*O[2]*~"[mM]"))+scale_x_continuous(breaks=c(-2, 0, 2))+
  facet_grid(rows=vars(Family), scales="free", space="free")

ggsave(filename = "diff_h2o2.jpeg", 
       path = "C:/Users/zuendj/Desktop/03_data R/oxidative stress/output_reanalysis", 
       width = 20,
       height = 22,
       units = c("cm"))

names<-list("O2"=expression(O[2]))

facet_labeller <- function(variable,value){
  return(names[value])
}
diff%>%
  subset(stress %in% c("O2"))->sub

sub<-left_join(sub, setNames(aggregate(sub$MIC, by=list(sub$bacteria), mean), c("bacteria", "order")))


sub%>%
mutate(bacteria = fct_reorder(bacteria, desc(sub$diff_conc)))%>%
ggplot(aes(y=bacteria, x=diff_conc))+
  geom_boxplot(outlier.shape=NA)+
  geom_jitter(width = 0.01, alpha=0.5, aes(colour=Family))+
   facet_grid(cols=vars(stress), scales="free", labeller = facet_labeller)+
  geom_vline(xintercept = 0, linetype="dashed")+
  theme(text = element_text(size=15), 
        axis.title.x = element_text(size=20),
        axis.text.x = element_text(size=15),
        axis.title.y= element_blank(),
        axis.text.y=element_text(size=15),
        strip.background = element_blank(),
        axis.ticks.y = element_blank(),
        legend.text = element_text(size = 15),
        legend.title = element_text(size= 15),
        plot.title = element_text(size=20, hjust=0.5),
        strip.text = element_blank(), 
        panel.background = element_rect(fill="white"),
        panel.border=element_rect(fill=NA))+
  ggtitle("Difference in lethal and growth-inhibiting levels")+
  labs(colour = "Family")+
  xlab(expression(??Agar~"[???]"))+
  scale_x_reverse()+
  facet_grid(rows=vars(Family), scales="free", space="free")

ggsave(filename = "diff_o2.jpeg", 
       path = "C:/Users/zuendj/Desktop/03_data R/oxidative stress/output_reanalysis", 
       width = 20,
       height = 22,
       units = c("cm"))




```



```{r}
names<-list("H2O2"=expression(H[2]*O[2]))

facet_labeller <- function(variable,value){
  return(names[value])}

heat%>%
  subset(stress %in% c("H2O2"))->sub

sub$value<-sub$value/1000

sub%>%
  mutate(Genus = fct_reorder(Genus, sub$median))%>%
  subset(!condition %in% "diff")%>%
  ggplot(aes(y=Genus, x=value))+
  geom_boxplot(aes(fill=condition), outlier.shape = NA)+
  geom_point(aes(colour=bacteria, group=condition), position = position_jitterdodge(0.1), alpha=0.7)+
   facet_grid(cols=vars(stress), scales="free", labeller = facet_labeller)+
  scale_fill_manual(values = c("coral", "steelblue3"), name="Condition", labels=c("Stress", "Post-stress"))+ scale_x_log10(breaks=0,0.5,5)+
  theme(text = element_text(size=15), 
        axis.title.x = element_text(size=20),
        axis.text.x = element_text(size=15),
        axis.title.y= element_blank(),
        axis.text.y=element_text(size=15),
        strip.text.y = element_text(face = "italic"),
        strip.background = element_blank(),
        axis.ticks.y = element_blank(),
        legend.text = element_text(size = 10),
        legend.title = element_text(size= 15),
        plot.title = element_text(size=20),
        strip.text = element_text(size=20), 
        panel.background = element_rect(fill="white"),
        panel.border=element_rect(fill=NA))+
  ggtitle("Stress- vs. post-stress tolerance")+
  labs(colour = "Species")
ggsave(filename = "H2O2.jpeg", 
       path = "C:/Users/zuendj/Desktop/03_data R/oxidative stress/output_reanalysis", 
       width = 22,
       height = 17,
       units = c("cm"))


names<-list("O2"=expression(O[2]))

facet_labeller <- function(variable,value){
  return(names[value])
}

heat%>%
  subset(stress %in% c("O2"))->sub

sub$value<-sub$value/1000

sub%>%
  mutate(Genus = fct_reorder(Genus, sub$median))%>%
  subset(!condition %in% "diff")%>%
  ggplot(aes(y=Genus, x=value))+
  geom_boxplot(aes(fill=condition), outlier.shape = NA)+
  geom_point(aes(colour=bacteria, group=condition), position = position_jitterdodge(0.1), alpha=0.7)+
   facet_grid(cols=vars(stress), scales="free", labeller = facet_labeller)+
  scale_fill_manual(values = c("coral", "steelblue3"), name="Condition", labels=c("Stress", "Post-stress"))+
  theme(text = element_text(size=15), 
        axis.title.x = element_text(size=20),
        axis.text.x = element_text(size=15),
        axis.title.y= element_blank(),
        axis.text.y=element_text(size=15),
        strip.text.y = element_text(face = "italic"),
        strip.background = element_blank(),
        axis.ticks.y = element_blank(),
        legend.text = element_text(size = 10),
        legend.title = element_text(size= 15),
        plot.title = element_text(size=20),
        strip.text = element_text(size=20), 
        panel.background = element_rect(fill="white"),
        panel.border=element_rect(fill=NA))+
  ggtitle("Stress- vs. post-stress tolerance")+
  labs(colour = "Species")
ggsave(filename = "O2.jpeg", 
       path = "C:/Users/zuendj/Desktop/03_data R/oxidative stress/output_reanalysis", 
       width = 22,
       height = 17,
       units = c("cm"))
```


#In silico
```{r}
coverage = read.csv(file = "C:/Users/zuendj/Desktop/03_data R/oxidative stress/input/final_coverage.csv", sep=";", header=T, check.names =F)
names(coverage)[2]<-"bacteria"
coverage<-coverage[,-1]
```


```{r}
all$multi<-all$diff*all$MIC


scale0to1 <- function(x){(x-min(x))/(max(x)-min(x))}

all[, c("MBC", "MIC", "diff", "multi")]<-scale0to1(all[, c("MBC", "MIC", "diff", "multi")])



coverage_growth<-left_join(all, coverage)
```

```{r}
coverage_growth%>%
  subset(stress %in% "O2")%>%
  gather(enzyme, coverage, "MBC":"ferredoxin")%>%
  subset(enzyme %in% c("superoxide dismutase", "diff", "MIC", "multi"))->sub

sub$coverage<-as.numeric(sub$coverage)

sub%>%
  ggplot(aes(y=bacteria, fill=coverage, x=enzyme))+
  geom_tile()
```

